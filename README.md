# Introduction

Playwright Dynamics365 Project  
This project leverages [Playwright](https://playwright.dev/) for end-to-end testing of Dynamics 365 CRM applications, with a modular Page Object Model, environment management, and robust reporting.

---

## Getting Started

This guide will help you set up, configure, and run tests for this project.

---

## Installation & Setup

### 1. Prerequisites

- [Node.js](https://nodejs.org/) (v22.13.1 recommended)
- [VS Code](https://code.visualstudio.com/) (free version)
- [Java JDK](https://adoptopenjdk.net/) (for Allure reporting)

### 2. Install Global Tools

```sh
npm install -g typescript
```

### 3. Set Execution Policy (Windows Only)

Open PowerShell as administrator and run:
```sh
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Unrestricted
```

### 4. Install Project Dependencies

```sh
npm install
npm init playwright@latest
```

### 5. Install Playwright Browsers

```sh
npx playwright install
```

### 6. Environment Variables

- Install dotenv for environment variable support:
  ```sh
  npm install dotenv
  npm install --save-dev cross-env
  ```
- Store credentials and URLs in `.env` files under `env.test/`.

### 7. Configure Storage State

- Login sessions are managed via `storageState.json` generated by `globals/global-setup.ts`.

### 8. Logging

- Winston is used for centralized logging.
  ```sh
  npm install winston
  ```
- Logger is integrated via `utils/logger.ts`.

---

## TypeScript Configuration

- The project uses a strict [`tsconfig.json`](tsconfig.json) for type safety and modern JavaScript features.
- All source files are included and compiled according to this configuration.
- You can customize TypeScript settings in [`tsconfig.json`](tsconfig.json).

---

## Linting with ESLint

- ESLint is configured for TypeScript using [`eslint.config.mjs`](eslint.config.mjs).
- To check code quality, run:
  ```sh
  npm run lint
  ```
- To automatically fix fixable issues:
  ```sh
  npx eslint . --ext .ts --fix
  ```
- Adjust rules in [`eslint.config.mjs`](eslint.config.mjs) as needed.

---

## Project Structure

```
├── page-objects/
│   ├── components/
│   │   ├── homePage.ts
│   │   ├── loginPage.ts
│   │   └── services/
│   │       └── cases.ts
│   └── pageObjectManager.ts
├── suites/
│   └── regression-suite/
│       ├── createNewCases.spec.ts
│       ├── editNewCases.spec.ts
│       └── resolveNewCases.spec.ts
├── fixtures/
│   └── pageObjects.ts
├── globals/
│   └── global-setup.ts
├── test-data/
│   ├── caseData.json
│   ├── subjectData.json
│   └── generateData/
│       └── createCase.json
├── utils/
│   ├── helper.ts
│   ├── logger.ts
│   └── autoPopupCloser.ts
├── env.test/
│   └── .env
│   └── environment.properties
├── storage-state/
│   └── storageState.json
├── scripts/
│   ├── generateEnvironmentProperties.ts
│   ├── generateAllureReport.ts
│   ├── runRegressionAll.ps1
├── playwright.config.ts
├── tsconfig.json
├── eslint.config.mjs
└── README.md
```

---

## Running Tests

### CLI Commands

- Run all tests:
  ```sh
  npm run test
  ```
- Run a single spec:
  ```sh
  npm run test:cases
  ```

### Sequential Test Execution

To run multiple specs in a specific order:
```sh
npx playwright test suites/regression-suite/createNewCases.spec.ts && npx playwright test suites/regression-suite/editNewCases.spec.ts && npx playwright test suites/regression-suite/resolveNewCases.spec.ts
```

### Running Tests on Multiple Browsers

- The project is configured to run tests on multiple browsers (Chromium, Firefox, WebKit, Edge).
- To enable or disable browsers, edit the `projects` array in [`playwright.config.ts`](playwright.config.ts):

  ```ts
  projects: [
    { name: 'chromium', use: { browserName: 'chromium' } },
    { name: 'firefox', use: { browserName: 'firefox' } },
    { name: 'webkit', use: { browserName: 'webkit' } },
    { name: 'edge', use: { browserName: 'chromium', channel: 'msedge' } }
  ]
  ```

- By default, Chromium is enabled. Uncomment or add other browsers as needed.

- To run tests on all configured browsers:
  ```sh
  npx playwright test
  ```

---

## Allure Reporting (with Dynamic Report Name)

- Allure is used for test reporting.
  ```sh
  npm install -D allure-playwright
  npm install -g allure-commandline --save-dev
  ```
- The `environment.properties` file is generated dynamically before the report, reflecting real-time config (browser, environment, framework, etc.).
- The Allure report name is also set dynamically from `environment.properties` (Framework property).
- The script `scripts/generateAllureReport.ts` reads the Framework value and passes it as the Allure report name.

**To generate and open the Allure report:**
```sh
npm run test:allureReport
```

**What happens:**
- `scripts/generateEnvironmentProperties.ts` creates/updates `env.test/environment.properties` with real-time values.
- `scripts/generateAllureReport.ts` reads the Framework value and generates the Allure report with the correct name.
- The report is opened automatically.

---

## Utilities & Advanced Features

- **Helper Utilities:**  
  Common waits, random data generation, and UI helpers in `utils/helper.ts`.
- **Auto Popup Closer:**  
  Automatically closes popups that may block test execution (`utils/autoPopupCloser.ts`).
- **Page Object Model:**  
  Encapsulates UI actions and selectors for maintainability (`page-objects/`).
- **Fixtures:**  
  Provides reusable test context and objects (`fixtures/pageObjects.ts`).
- **Global Setup:**  
  Handles login and storage state for all tests (`globals/global-setup.ts`).
- **Dynamic Test Data:**  
  Test data is managed in JSON files under `test-data/` and updated at runtime.

---

## Software Dependencies

- Node.js
- Playwright
- TypeScript
- dotenv
- winston
- allure-playwright
- allure-commandline
- cross-env
- eslint
- typescript-eslint
- ts-node

---

## Code Generation with Playwright Codegen

- Use Playwright's codegen to quickly generate test flows and selectors:
  ```sh
  npm run generate:codegen
  ```
- Refactor generated code into page objects and helper methods for maintainability.

---

## Latest Releases

Refer to the project repository or release notes for the latest updates.